# PromptTemplate 参数详细讲解
## 从你的代码说起
让我们先分析你代码中的 PromptTemplate：
```python
prompt = PromptTemplate(
    template="回答用户的查询.\n{format_instructions}\n{query}\n",
    input_variables=["query"],
    partial_variables={"format_instructions": format_instructions},
)
```
这里展示了三个核心参数，让我逐一详细解释。
---
## 1. `template` 参数
**作用**：定义提示词的模板字符串，包含占位符
```python
template="回答用户的查询.\n{format_instructions}\n{query}\n"
```
**详细说明**：
- 这是模板的核心内容
- 使用 `{变量名}` 作为占位符
- 占位符会在运行时被实际值替换
- 支持多行字符串和复杂的文本结构
**示例**：
```python
template = """
你是一个{role}。
请根据以下信息回答问题：
背景：{background}
问题：{question}
要求：{requirements}
回答：
"""
```
---
## 2. `input_variables` 参数
**作用**：定义需要从外部传入的变量列表
```python
input_variables=["query"]
```
**详细说明**：
- 告诉模板哪些变量需要在调用时动态传入
- 这些变量必须出现在 template 中作为占位符
- 调用时必须提供这些变量的值
**示例**：
```python
prompt = PromptTemplate(
    template="你是{role}，请回答：{question}",
    input_variables=["role", "question"]  # 两个变量都需要外部传入
)
# 调用时必须提供
result = prompt.format(role="专家", question="什么是AI？")
```
---
## 3. `partial_variables` 参数
**作用**：预填充某些变量的值，避免重复传入
```python
partial_variables={"format_instructions": format_instructions}
```
**详细说明**：
- 某些变量值是固定的或计算成本较高的，可以预先设置
- 这些变量不需要在调用时重复传入
- 可以包含动态计算的内容（如你的 `format_instructions`）
**示例**：
```python
# 固定的系统指令
system_prompt = "你是一个专业的AI助手，总是用简洁明了的语言回答问题。"
prompt = PromptTemplate(
    template="{system_prompt}\n\n用户问题：{question}",
    input_variables=["question"],
    partial_variables={"system_prompt": system_prompt}
)
# 调用时只需要传入 question
result = prompt.format(question="什么是机器学习？")
```
---
## 4. 其他重要参数
### `template_format` 参数
```python
prompt = PromptTemplate(
    template="回答：{question}",
    input_variables=["question"],
    template_format="f-string"  # 默认是 "f-string"，也可以是 "jinja2"
)
```
**说明**：
- `"f-string"`：使用 Python f-string 格式（默认）
- `"jinja2"`：使用 Jinja2 模板引擎，支持更复杂的逻辑
### `validate_template` 参数
```python
prompt = PromptTemplate(
    template="回答：{question}",
    input_variables=["question"],
    validate_template=True  # 默认为 True，验证模板格式
)
```
**说明**：
- 是否验证模板的格式正确性
- 建议保持开启，可以在早期发现错误
---
## 完整示例：展示所有参数
```python
from langchain_core.prompts import PromptTemplate
# 1. 定义复杂的模板
template = """
角色：{role}
专业领域：{field}
任务描述：
{task_description}
用户问题：{question}
回答要求：
1. 语言：{language}
2. 风格：{style}
3. 长度：{length}
请根据以上要求回答问题。
"""
# 2. 设置部分变量（固定的值）
partial_vars = {
    "role": "AI助手",
    "language": "中文",
    "style": "专业且易懂",
    "length": "200字以内"
}
# 3. 创建完整的 PromptTemplate
prompt = PromptTemplate(
    template=template,
    input_variables=["field", "task_description", "question"],
    partial_variables=partial_vars,
    template_format="f-string",
    validate_template=True
)
# 4. 使用示例
result = prompt.format(
    field="机器学习",
    task_description="解释机器学习的基本概念",
    question="什么是监督学习？"
)
print(result)
```
---
## 高级用法：动态模板
### 1. 使用函数生成部分变量
```python
def get_current_time():
    import datetime
    return datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")
prompt = PromptTemplate(
    template="当前时间：{current_time}\n用户问题：{question}",
    input_variables=["question"],
    partial_variables={"current_time": get_current_time()}
)
```
### 2. 嵌套模板
```python
# 子模板
sub_template = PromptTemplate.from_template("专注于{field}")
# 主模板
main_template = PromptTemplate(
    template="你是{role}。\n{description}\n请回答：{question}",
    input_variables=["role", "question"],
    partial_variables={
        "description": sub_template.format(field="人工智能")
    }
)
```
### 3. 条件模板
```python
def create_prompt(is_expert=True):
    base_template = "请回答：{question}"
    
    if is_expert:
        template = f"作为专家，{base_template}"
    else:
        template = f"用简单的话，{base_template}"
    
    return PromptTemplate(
        template=template,
        input_variables=["question"]
    )
# 根据条件创建不同的模板
expert_prompt = create_prompt(is_expert=True)
beginner_prompt = create_prompt(is_expert=False)
```
---
## 最佳实践建议
1. **变量命名要清晰**：使用有意义的变量名，如 `user_question` 而不是 `q`
2. **合理使用 partial_variables**：
   - 固定的系统指令
   - 格式化要求
   - 计算成本较高的内容
3. **模板结构化**：使用清晰的段落和分隔符，提高可读性
4. **验证模板**：开发时保持 `validate_template=True`
5. **文档化**：为复杂的模板添加注释说明
---
## 总结
PromptTemplate 的参数设计非常灵活：
- **`template`**：定义模板内容
- **`input_variables`**：动态传入的变量
- **`partial_variables`**：预填充的固定变量
- **`template_format`**：模板格式选择
- **`validate_template`**：格式验证开关
通过合理组合这些参数，你可以创建出既灵活又高效的提示词模板，适应各种不同的应用场景。

--------------------------------
以上内容由AI生成，仅供参考和借鉴