这个模板与 `FewShotPromptTemplate` 的核心区别在于，它专门为**聊天模型**设计，输出的不是纯文本，而是一个结构化的**消息列表**（包含 `SystemMessage`, `HumanMessage`, `AIMessage`）。这就像给 AI 一个完整的"剧本"，而不仅仅是"台词"。
---
## 场景设定：打造一个角色扮演 AI 助手
假设我们要创建一个**幽默风趣的程序员助手**，它不仅能回答技术问题，还会用程序员的梗来交流。
### 完整代码案例
```python
import os
from dotenv import load_dotenv
from langchain_openai import ChatOpenAI
from langchain_core.prompts import ChatPromptTemplate, FewShotChatMessagePromptTemplate
from langchain_core.messages import SystemMessage
load_dotenv()
# 初始化模型
chat_model = ChatOpenAI(model="gpt-3.5-turbo")
# 1. 定义示例集合 - 这是"剧本"的核心片段
# 每个示例都展示了用户如何提问，AI应该如何以"幽默程序员"的身份回答
examples = [
    {
        "input": "我的代码有bug，怎么办？",
        "output": "别慌，代码里的bug不是bug，是未公开的特性。让我看看你的'特性'是什么。"
    },
    {
        "input": "为什么我的程序这么慢？",
        "output": "因为它在深思熟虑，就像你面对一个复杂的需求一样。或者，可能只是你忘了写索引。"
    },
    {
        "input": "我想学Python，难吗？",
        "output": "不难，Python的语法就像说英语一样简单。唯一的问题是，计算机有时候比较'笨'，你得把话说得特别清楚。"
    }
]
# 2. 创建示例格式模板 - 定义如何将每个示例转换成"对话"
# 这里我们把用户的输入变成 HumanMessage，AI的回答变成 AIMessage
example_prompt = ChatPromptTemplate.from_messages([
    ("human", "{input}"),
    ("ai", "{output}"),
])
# 3. 创建 FewShotChatMessagePromptTemplate 实例
# 这会把我们的示例和格式组合成一个可重用的"剧本片段"
few_shot_prompt = FewShotChatMessagePromptTemplate(
    examples=examples,
    example_prompt=example_prompt,
)
# 4. 构建最终的完整提示词
# 完整的提示词 = 系统角色设定 + 示例剧本 + 最终问题
final_prompt = ChatPromptTemplate.from_messages([
    ("system", "你是一个幽默风趣的程序员助手，擅长用程序员梗来回答技术问题。"),
    few_shot_prompt,  # 插入我们创建的示例剧本
    ("human", "{input}"),  # 用户最终的问题
])
# 5. 创建链并调用
chain = final_prompt | chat_model
# 测试一下
response = chain.invoke({"input": "我的电脑又蓝屏了，是不是该换Mac了？"})
print(response.content)
```
### 预期输出
```
蓝屏是Windows在给你放'蓝色假期'，让你休息一下。换Mac也行，不过到时候你可能会怀念'蓝色假期'的，毕竟Mac的崩溃界面是灰色的，比较单调。先试试重启大法吧，这招解决了90%的'假期'问题。
```
---
## 详细参数解释
### 1. `examples` (示例集合)
```python
examples = [
    {"input": "用户的问题", "output": "AI的期望回答"},
    # ...
]
```
- **作用**：提供"标准对话"示例。
- **格式**：一个字典列表，每个字典包含 `input` 和 `output`。
- **关键点**：这里的 `output` 内容定义了 AI 应该扮演的**角色、语气和风格**。
### 2. `example_prompt` (示例格式模板)
```python
example_prompt = ChatPromptTemplate.from_messages([
    ("human", "{input}"),
    ("ai", "{output}"),
])
```
- **作用**：这是与 `FewShotPromptTemplate` 最核心的区别！它定义了如何将 `examples` 中的每个字典**转换成一条消息**。
- **格式**：它本身就是一个 `ChatPromptTemplate`。
- **解释**：
  - `("human", "{input}")` 告诉模板：把字典里的 `input` 值包装成 `HumanMessage`。
  - `("ai", "{output}")` 告诉模板：把字典里的 `output` 值包装成 `AIMessage`。
### 3. `FewShotChatMessagePromptTemplate` 实例
```python
few_shot_prompt = FewShotChatMessagePromptTemplate(
    examples=examples,
    example_prompt=example_prompt,
)
```
- **作用**：将示例和格式结合起来，生成一个**消息列表**。
- **输出**：当你调用 `few_shot_prompt.format()` 时，它不会返回字符串，而是返回一个消息列表，类似这样：
  ```python
  [
      HumanMessage(content="我的代码有bug，怎么办？"),
      AIMessage(content="别慌，代码里的bug不是bug..."),
      HumanMessage(content="为什么我的程序这么慢？"),
      AIMessage(content="因为它在深思熟虑..."),
      # ... 所有示例都会被转换
  ]
  ```
### 4. 组装最终提示词
```python
final_prompt = ChatPromptTemplate.from_messages([
    ("system", "你是一个幽默风趣的程序员助手..."),
    few_shot_prompt,  # 插入消息列表
    ("human", "{input}"),
])
```
- **作用**：将所有部分组合成一个完整的对话流程。
- **结构**：
  1.  **System Message**：设定 AI 的全局角色。
  2.  **Few-Shot Examples**：提供具体的对话风格示例。
  3.  **Final Human Message**：用户真正要问的问题。
---
## 与 `FewShotPromptTemplate` 的核心对比
| 特性 | `FewShotPromptTemplate` | `FewShotChatMessagePromptTemplate` |
| :--- | :--- | :--- |
| **目标模型** | 文本补全模型 (LLM) | 聊天模型 |
| **输出格式** | 单个**字符串** | **消息列表** (`List[BaseMessage]`) |
| **`example_prompt`** | `PromptTemplate` (文本模板) | `ChatPromptTemplate` (消息模板) |
| **适用场景** | 简单的文本生成任务 | 需要角色、上下文、多轮对话的复杂任务 |
| **结构感** | 弱，纯文本拼接 | 强，清晰的消息结构 |
## 总结
使用 `FewShotChatMessagePromptTemplate` 的最佳时机是：
- **你需要控制 AI 的角色和语气**（如客服、老师、幽默助手）。
- **任务涉及多轮对话**，需要展示对话的流程。
- **你使用的是 GPT-4、Claude 等现代聊天模型**。
它通过提供结构化的对话示例，让 AI 更好地理解并模仿你期望的行为模式，是构建高质量对话式 AI 应用的利器！

--------------------------------
以上内容由AI生成，仅供参考和借鉴